<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Redirector Admin</title>
    <script src="/static/tailwind.min.js"></script>
    <script src="/static/chart.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                        mono: ['JetBrains Mono', 'SF Mono', 'monospace'],
                    },
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* Theme variables */
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --bg-hover: #e2e8f0;
            --border-color: rgba(148, 163, 184, 0.2);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --accent: #3b82f6;
            --accent-secondary: #6366f1;
            --accent-glow: rgba(59, 130, 246, 0.15);
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --chart-grid: rgba(226, 232, 240, 0.8);
        }

        .dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-hover: #475569;
            --border-color: rgba(148, 163, 184, 0.1);
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --accent: #60a5fa;
            --accent-secondary: #818cf8;
            --accent-glow: rgba(96, 165, 250, 0.15);
            --chart-grid: rgba(51, 65, 85, 0.5);
        }

        .theme-warm {
            --bg-primary: #1c1917;
            --bg-secondary: #292524;
            --bg-tertiary: #44403c;
            --bg-hover: #57534e;
            --border-color: rgba(168, 162, 158, 0.15);
            --text-primary: #fafaf9;
            --text-secondary: #d6d3d1;
            --text-muted: #78716c;
            --accent: #f59e0b;
            --accent-secondary: #f97316;
            --accent-glow: rgba(245, 158, 11, 0.15);
            --success: #22c55e;
            --warning: #fbbf24;
            --danger: #f87171;
            --chart-grid: rgba(68, 64, 60, 0.5);
        }

        /* Smooth transitions */
        * { transition: background-color 0.3s ease, border-color 0.3s ease, color 0.2s ease; }

        /* Background */
        .bg-app {
            background-color: var(--bg-primary);
            background-image:
                radial-gradient(at 0% 0%, var(--accent-glow) 0px, transparent 50%),
                radial-gradient(at 100% 100%, var(--accent-glow) 0px, transparent 50%);
            min-height: 100vh;
        }

        /* Header glass effect */
        .header-glass {
            background: color-mix(in srgb, var(--bg-secondary) 80%, transparent);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
        }

        /* Card styling */
        .card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .card-highlight {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-secondary) 100%);
            border: none;
            box-shadow: 0 8px 32px -8px var(--accent-glow);
        }

        /* Stat card hover */
        .stat-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px -8px rgba(0, 0, 0, 0.15);
        }

        /* Icon containers */
        .icon-container {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .icon-violet { background: rgba(139, 92, 246, 0.15); color: #8b5cf6; }
        .icon-orange { background: rgba(249, 115, 22, 0.15); color: #f97316; }
        .icon-cyan { background: rgba(6, 182, 212, 0.15); color: #06b6d4; }
        .icon-emerald { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .icon-blue { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }

        .theme-warm .icon-violet { background: rgba(251, 191, 36, 0.15); color: #fbbf24; }
        .theme-warm .icon-orange { background: rgba(251, 146, 60, 0.15); color: #fb923c; }
        .theme-warm .icon-cyan { background: rgba(253, 186, 116, 0.15); color: #fdba74; }
        .theme-warm .icon-emerald { background: rgba(163, 230, 53, 0.15); color: #a3e635; }
        .theme-warm .icon-blue { background: rgba(245, 158, 11, 0.15); color: #f59e0b; }

        /* Progress bar */
        .progress-bar {
            background: var(--bg-tertiary);
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, var(--success) 0%, #34d399 100%);
            border-radius: 999px;
            position: relative;
        }

        .progress-shimmer::after {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Live indicator */
        .live-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Theme button */
        .theme-btn {
            color: var(--text-muted);
            transition: all 0.2s ease;
        }

        .theme-btn:hover {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .theme-btn-active {
            background: var(--accent-glow) !important;
            color: var(--accent) !important;
        }

        /* Simulation controls */
        .sim-control {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 8px 12px;
        }

        input[type="range"] {
            -webkit-appearance: none;
            background: transparent;
            width: 100%;
        }

        input[type="range"]::-webkit-slider-track {
            height: 4px;
            border-radius: 2px;
            background: var(--bg-hover);
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent);
            margin-top: -6px;
            cursor: pointer;
            transition: transform 0.15s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.15);
        }

        /* Button */
        .btn-primary {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: white;
            font-weight: 500;
            padding: 6px 14px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px -2px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
        }

        .btn-danger:hover {
            box-shadow: 0 4px 12px -2px rgba(239, 68, 68, 0.4);
        }

        /* Recent redirects item */
        .redirect-item {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 12px;
            transition: all 0.2s ease;
        }

        .redirect-item:hover {
            background: var(--bg-hover);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--text-muted); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }

        /* Fade in animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        .animate-delay-1 { animation-delay: 0.05s; opacity: 0; }
        .animate-delay-2 { animation-delay: 0.1s; opacity: 0; }
        .animate-delay-3 { animation-delay: 0.15s; opacity: 0; }
        .animate-delay-4 { animation-delay: 0.2s; opacity: 0; }
    </style>
    <script>
        function getTheme() {
            return localStorage.getItem('theme') || 'light';
        }

        function applyTheme(theme) {
            document.documentElement.classList.remove('dark', 'theme-warm');
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else if (theme === 'warm') {
                document.documentElement.classList.add('dark', 'theme-warm');
            }
            localStorage.setItem('theme', theme);
            updateThemeButtons(theme);
            if (typeof updateChartColors === 'function') updateChartColors();
        }

        function updateThemeButtons(theme) {
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('theme-btn-active');
                if (btn.dataset.theme === theme) {
                    btn.classList.add('theme-btn-active');
                }
            });
        }

        applyTheme(getTheme());
        document.addEventListener('DOMContentLoaded', () => updateThemeButtons(getTheme()));
    </script>
</head>
<body class="bg-app">
    <!-- Header -->
    <header class="header-glass sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 py-3">
            <div class="flex items-center justify-between">
                <!-- Logo & Title -->
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center shadow-lg">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-semibold leading-tight" style="color: var(--text-primary)">redirector</h1>
                        <span class="text-xs" style="color: var(--text-muted)">admin dashboard</span>
                    </div>
                    <!-- Live indicator -->
                    <div class="hidden sm:flex items-center gap-2 ml-4 px-3 py-1.5 rounded-full" style="background: rgba(16, 185, 129, 0.1)">
                        <span class="live-dot"></span>
                        <span class="text-xs font-medium" style="color: var(--success)">Live</span>
                    </div>
                </div>

                <!-- Controls -->
                <div class="flex items-center gap-3">
                    <!-- Simulate Load -->
                    <div class="hidden md:flex items-center gap-3 sim-control">
                        <svg class="w-4 h-4" style="color: var(--text-muted)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                        <input type="range" id="sim-rps" min="100" max="5000" value="1000" step="100" class="w-24">
                        <span id="sim-rps-label" class="text-xs font-mono w-16 text-right" style="color: var(--text-secondary)">1000 rps</span>
                        <button id="sim-btn" onclick="toggleSimulation()" class="btn-primary flex items-center gap-1.5">
                            <svg class="w-3.5 h-3.5" id="sim-icon-play" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                            <svg class="w-3.5 h-3.5 hidden" id="sim-icon-stop" fill="currentColor" viewBox="0 0 24 24"><rect x="6" y="6" width="12" height="12" rx="1"/></svg>
                            <span id="sim-text">Start</span>
                        </button>
                    </div>

                    <!-- Theme toggle -->
                    <div class="flex gap-1 p-1 rounded-xl" style="background: var(--bg-tertiary)">
                        <button onclick="applyTheme('light')" data-theme="light" class="theme-btn p-2 rounded-lg" title="Light">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="4" stroke-width="2"/>
                                <path stroke-linecap="round" stroke-width="2" d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M4.93 19.07l1.41-1.41m11.32-11.32l1.41-1.41"/>
                            </svg>
                        </button>
                        <button onclick="applyTheme('dark')" data-theme="dark" class="theme-btn p-2 rounded-lg" title="Dark">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"/>
                            </svg>
                        </button>
                        <button onclick="applyTheme('warm')" data-theme="warm" class="theme-btn p-2 rounded-lg" title="Warm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"/>
                            </svg>
                        </button>
                    </div>

                    <!-- Logout -->
                    <form action="/admin/logout" method="POST">
                        <button type="submit" class="p-2 rounded-lg transition-all hover:bg-red-500/10" style="color: var(--text-muted)" title="Logout">
                            <svg class="w-5 h-5 hover:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
                            </svg>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-6 space-y-6">
        <!-- Stats Grid -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
            <!-- Uptime -->
            <div class="card stat-card p-5 animate-fade-in animate-delay-1">
                <div class="flex items-center gap-3 mb-3">
                    <div class="icon-container icon-violet">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium" style="color: var(--text-muted)">Uptime</span>
                </div>
                <div class="text-2xl font-bold" style="color: var(--text-primary)" id="stat-uptime">--</div>
            </div>

            <!-- CPU -->
            <div class="card stat-card p-5 animate-fade-in animate-delay-2">
                <div class="flex items-center gap-3 mb-3">
                    <div class="icon-container icon-orange">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium" style="color: var(--text-muted)">CPU</span>
                </div>
                <div class="text-2xl font-bold" style="color: var(--text-primary)">
                    <span id="stat-cpu">--</span><span class="text-lg" style="color: var(--text-muted)">%</span>
                </div>
            </div>

            <!-- Memory -->
            <div class="card stat-card p-5 animate-fade-in animate-delay-3">
                <div class="flex items-center gap-3 mb-3">
                    <div class="icon-container icon-cyan">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium" style="color: var(--text-muted)">Memory</span>
                </div>
                <div class="text-2xl font-bold" style="color: var(--text-primary)">
                    <span id="stat-memory">--</span><span class="text-lg ml-1" style="color: var(--text-muted)">MB</span>
                </div>
            </div>

            <!-- RPS (Highlighted) -->
            <div class="card card-highlight stat-card p-5 animate-fade-in animate-delay-4">
                <div class="flex items-center gap-3 mb-3">
                    <div class="icon-container" style="background: rgba(255,255,255,0.2)">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    <span class="text-sm font-medium text-white/80">RPS</span>
                </div>
                <div class="text-2xl font-bold text-white" id="stat-rps">--</div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid lg:grid-cols-2 gap-4">
            <!-- RPS Chart -->
            <div class="card p-5">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-semibold" style="color: var(--text-primary)">Requests per Second</h3>
                    <span class="text-xs" style="color: var(--text-muted)">Last 60 seconds</span>
                </div>
                <div class="h-64">
                    <canvas id="rpsChart"></canvas>
                </div>
            </div>

            <!-- Latency Chart -->
            <div class="card p-5">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-semibold" style="color: var(--text-primary)">Response Latency</h3>
                    <div class="flex items-center gap-3 text-xs" style="color: var(--text-muted)">
                        <span class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full" style="background: var(--success)"></span>p50</span>
                        <span class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full" style="background: var(--warning)"></span>p95</span>
                        <span class="flex items-center gap-1.5"><span class="w-2 h-2 rounded-full" style="background: var(--danger)"></span>p99</span>
                    </div>
                </div>
                <div class="h-64">
                    <canvas id="latencyChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Cache Hit Rate -->
        <div class="card p-5">
            <div class="flex flex-col sm:flex-row sm:items-center gap-4">
                <div class="flex items-center gap-3">
                    <div class="icon-container icon-emerald">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                        </svg>
                    </div>
                    <span class="text-sm font-semibold" style="color: var(--text-primary)">Cache Hit Rate</span>
                </div>
                <div class="flex-1">
                    <div class="progress-bar h-3">
                        <div id="cache-bar" class="progress-fill progress-shimmer h-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <span class="text-2xl font-bold" style="color: var(--success)" id="stat-cache">0%</span>
                    <div class="text-right">
                        <div class="text-xs" style="color: var(--text-muted)">Total requests</div>
                        <div class="text-sm font-semibold" style="color: var(--text-secondary)" id="stat-total">0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Redirects -->
        <div class="card p-5">
            <div class="flex items-center gap-3 mb-4">
                <div class="icon-container icon-blue">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                    </svg>
                </div>
                <h3 class="text-sm font-semibold" style="color: var(--text-primary)">Recent Redirects</h3>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-2" id="recent-list">
                <div class="text-sm p-3" style="color: var(--text-muted)">No recent redirects</div>
            </div>
        </div>
    </main>

    <!-- Mobile simulation controls -->
    <div class="md:hidden fixed bottom-4 left-4 right-4 card p-4 shadow-xl">
        <div class="flex items-center gap-3">
            <svg class="w-4 h-4 shrink-0" style="color: var(--text-muted)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            <input type="range" id="sim-rps-mobile" min="100" max="5000" value="1000" step="100" class="flex-1">
            <span id="sim-rps-label-mobile" class="text-xs font-mono w-12 text-right" style="color: var(--text-secondary)">1000</span>
            <button id="sim-btn-mobile" onclick="toggleSimulation()" class="btn-primary px-4 py-2">
                Start
            </button>
        </div>
    </div>

    <script>
        // Chart setup
        const maxDataPoints = 60;
        const rpsData = { labels: [], data: [] };
        const latencyData = { labels: [], p50: [], p95: [], p99: [] };

        function getCSSVar(name) {
            return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        }

        function getChartColors() {
            return {
                text: getCSSVar('--text-muted'),
                grid: getCSSVar('--chart-grid'),
                accent: getCSSVar('--accent'),
                accentGlow: getCSSVar('--accent-glow'),
                success: getCSSVar('--success'),
                warning: getCSSVar('--warning'),
                danger: getCSSVar('--danger'),
            };
        }

        let colors = getChartColors();

        const rpsChart = new Chart(document.getElementById('rpsChart'), {
            type: 'line',
            data: {
                labels: rpsData.labels,
                datasets: [{
                    label: 'RPS',
                    data: rpsData.data,
                    borderColor: colors.accent,
                    backgroundColor: colors.accentGlow,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    pointHitRadius: 20,
                    borderWidth: 2,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { intersect: false, mode: 'index' },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                        titleColor: '#f8fafc',
                        bodyColor: '#e2e8f0',
                        padding: 12,
                        cornerRadius: 8,
                        displayColors: false,
                        callbacks: {
                            title: () => 'Requests per Second',
                            label: (ctx) => `${ctx.parsed.y.toFixed(0)} req/s`
                        }
                    }
                },
                scales: {
                    x: { display: false },
                    y: {
                        beginAtZero: true,
                        grid: { color: colors.grid, drawBorder: false },
                        ticks: { color: colors.text, font: { size: 11 } },
                        border: { display: false }
                    }
                }
            }
        });

        const latencyChart = new Chart(document.getElementById('latencyChart'), {
            type: 'line',
            data: {
                labels: latencyData.labels,
                datasets: [
                    { label: 'p50', data: latencyData.p50, borderColor: colors.success, backgroundColor: 'transparent', tension: 0.4, pointRadius: 0, pointHoverRadius: 6, borderWidth: 2 },
                    { label: 'p95', data: latencyData.p95, borderColor: colors.warning, backgroundColor: 'transparent', tension: 0.4, pointRadius: 0, pointHoverRadius: 6, borderWidth: 2 },
                    { label: 'p99', data: latencyData.p99, borderColor: colors.danger, backgroundColor: 'transparent', tension: 0.4, pointRadius: 0, pointHoverRadius: 6, borderWidth: 2 },
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { intersect: false, mode: 'index' },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.9)',
                        titleColor: '#f8fafc',
                        bodyColor: '#e2e8f0',
                        padding: 12,
                        cornerRadius: 8,
                        callbacks: {
                            title: () => 'Response Latency',
                            label: (ctx) => `${ctx.dataset.label}: ${ctx.parsed.y.toFixed(2)} ms`
                        }
                    }
                },
                scales: {
                    x: { display: false },
                    y: {
                        beginAtZero: true,
                        grid: { color: colors.grid, drawBorder: false },
                        ticks: { color: colors.text, font: { size: 11 }, callback: (v) => v + ' ms' },
                        border: { display: false }
                    }
                }
            }
        });

        function updateChartColors() {
            colors = getChartColors();
            rpsChart.data.datasets[0].borderColor = colors.accent;
            rpsChart.data.datasets[0].backgroundColor = colors.accentGlow;
            rpsChart.options.scales.y.grid.color = colors.grid;
            rpsChart.options.scales.y.ticks.color = colors.text;

            latencyChart.data.datasets[0].borderColor = colors.success;
            latencyChart.data.datasets[1].borderColor = colors.warning;
            latencyChart.data.datasets[2].borderColor = colors.danger;
            latencyChart.options.scales.y.grid.color = colors.grid;
            latencyChart.options.scales.y.ticks.color = colors.text;

            rpsChart.update('none');
            latencyChart.update('none');
        }

        // Format uptime
        function formatUptime(secs) {
            const days = Math.floor(secs / 86400);
            const hours = Math.floor((secs % 86400) / 3600);
            const mins = Math.floor((secs % 3600) / 60);
            if (days > 0) return `${days}d ${hours}h`;
            if (hours > 0) return `${hours}h ${mins}m`;
            return `${mins}m`;
        }

        // Format URL for display
        function formatUrl(url, maxLen = 45) {
            try {
                const u = new URL(url);
                const display = u.hostname + u.pathname;
                return display.length <= maxLen ? display : display.substring(0, maxLen) + '...';
            } catch {
                return url.length <= maxLen ? url : url.substring(0, maxLen) + '...';
            }
        }

        // SSE connection
        const evtSource = new EventSource('/admin/events');

        evtSource.onmessage = function(event) {
            const data = JSON.parse(event.data);
            const now = new Date().toLocaleTimeString('en-US', { hour12: false });

            // Update stats
            document.getElementById('stat-uptime').textContent = formatUptime(data.system.uptime_secs);
            document.getElementById('stat-cpu').textContent = data.system.cpu_percent.toFixed(1);
            document.getElementById('stat-memory').textContent = data.system.memory_mb;
            document.getElementById('stat-rps').textContent = data.app.rps.toFixed(0);

            const cacheRate = (data.app.cache_hit_rate * 100).toFixed(1);
            document.getElementById('stat-cache').textContent = cacheRate + '%';
            document.getElementById('cache-bar').style.width = cacheRate + '%';
            document.getElementById('stat-total').textContent = data.app.total_requests.toLocaleString();

            // Update RPS chart
            rpsData.labels.push(now);
            rpsData.data.push(data.app.rps);
            if (rpsData.labels.length > maxDataPoints) {
                rpsData.labels.shift();
                rpsData.data.shift();
            }
            rpsChart.update('none');

            // Update latency chart
            latencyData.labels.push(now);
            latencyData.p50.push(data.app.latency_p50_ms);
            latencyData.p95.push(data.app.latency_p95_ms);
            latencyData.p99.push(data.app.latency_p99_ms);
            if (latencyData.labels.length > maxDataPoints) {
                latencyData.labels.shift();
                latencyData.p50.shift();
                latencyData.p95.shift();
                latencyData.p99.shift();
            }
            latencyChart.update('none');

            // Update recent redirects
            if (data.recent && data.recent.length > 0) {
                const list = document.getElementById('recent-list');
                list.innerHTML = data.recent.map(r => `
                    <a href="/d/${r.hashid}" target="_blank" class="redirect-item group flex items-center gap-3">
                        <code class="text-sm font-mono font-medium group-hover:underline" style="color: var(--accent)">${r.hashid}</code>
                        <svg class="w-4 h-4 shrink-0" style="color: var(--text-muted)" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                        </svg>
                        <span class="text-sm truncate" style="color: var(--text-secondary)" title="${r.url}">${formatUrl(r.url)}</span>
                    </a>
                `).join('');
            }
        };

        evtSource.onerror = function() {
            console.error('SSE connection lost, reconnecting...');
        };

        // Simulation controls
        let simRunning = false;
        let simTimeout = null;

        const simRpsInput = document.getElementById('sim-rps');
        const simRpsMobile = document.getElementById('sim-rps-mobile');
        const simRpsLabel = document.getElementById('sim-rps-label');
        const simRpsLabelMobile = document.getElementById('sim-rps-label-mobile');
        const simBtn = document.getElementById('sim-btn');
        const simBtnMobile = document.getElementById('sim-btn-mobile');
        const simIconPlay = document.getElementById('sim-icon-play');
        const simIconStop = document.getElementById('sim-icon-stop');
        const simText = document.getElementById('sim-text');

        function updateRpsLabel(value) {
            simRpsLabel.textContent = value + ' rps';
            simRpsLabelMobile.textContent = value;
        }

        simRpsInput.addEventListener('input', () => {
            simRpsMobile.value = simRpsInput.value;
            updateRpsLabel(simRpsInput.value);
        });

        simRpsMobile.addEventListener('input', () => {
            simRpsInput.value = simRpsMobile.value;
            updateRpsLabel(simRpsMobile.value);
        });

        function getSimParams() {
            const rps = parseInt(simRpsInput.value);
            return { interval: 1000 / Math.min(rps, 100), batchSize: Math.ceil(rps / 100) };
        }

        async function runSimulationStep() {
            if (!simRunning) return;
            const { interval, batchSize } = getSimParams();
            const promises = [];
            for (let i = 0; i < batchSize; i++) {
                promises.push(fetch('/admin/simulate', { method: 'POST' }).catch(() => {}));
            }
            await Promise.all(promises);
            if (simRunning) simTimeout = setTimeout(runSimulationStep, interval);
        }

        function toggleSimulation() {
            if (simRunning) {
                simRunning = false;
                if (simTimeout) clearTimeout(simTimeout);
                simText.textContent = 'Start';
                simBtnMobile.textContent = 'Start';
                simIconPlay.classList.remove('hidden');
                simIconStop.classList.add('hidden');
                simBtn.classList.remove('btn-danger');
                simBtnMobile.classList.remove('btn-danger');
            } else {
                simRunning = true;
                simText.textContent = 'Stop';
                simBtnMobile.textContent = 'Stop';
                simIconPlay.classList.add('hidden');
                simIconStop.classList.remove('hidden');
                simBtn.classList.add('btn-danger');
                simBtnMobile.classList.add('btn-danger');
                runSimulationStep();
            }
        }
    </script>
</body>
</html>
