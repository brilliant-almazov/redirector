# ---------------------------------------------------------------
# Environment variable overrides
# ---------------------------------------------------------------
# Any config value can be overridden via env vars with the
# REDIRECTOR__ prefix and __ as the nesting separator:
#
#   REDIRECTOR__SERVER__PORT=3000
#   REDIRECTOR__DATABASE__URL=postgres://user:pass@host/db
#   REDIRECTOR__REDIS__URL=redis://host:6379
#   REDIRECTOR__REDIS__CACHE_TTL_SECONDS=3600
#   REDIRECTOR__METRICS__BASIC_AUTH__USERNAME=admin
#   REDIRECTOR__RATE_LIMIT__REQUESTS_PER_SECOND=500
#
# Standard PaaS variables are also supported (lower priority
# than REDIRECTOR__* if both are set):
#
#   DATABASE_URL=postgres://user:pass@host/db
#   REDIS_URL=redis://host:6379
#   RABBITMQ_URL=amqp://guest:guest@host:5672/%2f
#   PORT=3000
# ---------------------------------------------------------------

server:
  host: "0.0.0.0"
  port: 8080

hashids:
  salts:
    - "your_current_salt_here"
    - "your_old_salt_here"
  min_length: 6

redis:
  url: "redis://localhost:6379"
  cache_ttl_seconds: 86400  # 24 hours

database:
  url: "postgres://user:password@localhost:5432/database"
  pool:
    max_connections: 3
    connect_timeout_seconds: 3
  rate_limit:
    max_requests_per_second: 50
  circuit_breaker:
    failure_threshold: 3
    reset_timeout_seconds: 60

interstitial:
  delay_seconds: 5

metrics:
  basic_auth:
    username: "prometheus"
    password: "change_me_in_production"

rate_limit:
  requests_per_second: 1000
  burst: 100

# Event publishing (optional)
# When enabled, redirect events are published to RabbitMQ
# for analytics processing by event_consumer binary.
# Uses direct queue publishing (no exchange).
events:
  enabled: false
  rabbitmq:
    url: "amqp://guest:guest@localhost:5672/%2f"
    queue: "events.analytics"
  publisher:
    channel_buffer_size: 10000    # mpsc channel capacity
    batch_size: 100               # events per RabbitMQ message
    flush_interval_ms: 1000       # max ms before sending partial batch
  consumer:
    prefetch_count: 10
    database_url: "postgres://user:password@localhost:5432/redirector_analytics"
